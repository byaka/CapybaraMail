Основной интерфейс задуман как инструмент для работы с бэклогом, где каждое письмо это таск.

Все письма сгруппированы в диалоги и отображаются ВСЕГДА в виде диалогов. Также есть 3+ папки:

* Входящие (сюда попадает вся новая почта, эта папка автоматически назначается всем непрочитанным диалогам).
* Задачи (она же бэклог, сюда помещаются письма, которые по сути являются заданиями, тасками и которые лежат там до тех пор, пока соответствующая им в реальности задача не будет выполнена).
* Заметки (сюда попадают письма, которые по сути памятки, например доступы к серверу или скан документа и т.д.)
* Иные, созданные пользователем, но вообще предполагается что этого хватит.

Если письмо не принадлежит ни одной из этих папок - оно находится в архиве, и доступ к нему можно получить только при помощи поиска или фильтров (о них ниже).

Перемещение между папками происходит вручную, или при помощи созданных пользователем специальных условий (Ну например для автоматических уведомлений от гитхаба о закрытии багрепорта, если существовало письмо). Также предполагается, что будут существовать специальные ярлыки, назначаемые автоматически при "архивировании" диалога из папки (кроме входящих канешно). Они нужны для возможности искать по, например, всем письмам в архиве, которые ранее были "задачами". Автоматическое назначение этих ярлыков будет выполняться на стороне клиента, тобеш реализовывать его придется тебе.

При этом важно понимать - на уровне апи и ниже папок не существует - есть только ярлыки. Ну или категории или тэги, если так удобнее. Любое письмо может быть помечено любым количеством тегов. У диалогов нет тегов, считается что у диалога совокупность тегов из всех его сообщений. Как же тогда реализовать папки из описания выше - это те же самые ярлыки с заранее заданными названиями, их названия хранятся в настройках аккаунта (там можно хранить любые данные) и при запуске веб-приложение, запросив и прочитав эти настройки, далее считает что именно эти ярлыки являются условными папками.

Диалог считается непрочитанным, если в нем есть хотя бы одно непрочитанное сообщение. Если диалог помечен любой папкой кроме Входящих, и в него приходит новое письмо - он начинает отображаться сразу и там и там.

В любых иных случаях не допускается попадание диалога более чем в одну папку. Тоесть любой диалог может одновременно находиться только в одной папке, **за исключением папки Входящие**, она может быть назначена как второй. Данное ограничение введено специально, и на уровне апи и ниже (в том числе на уровне хранилища) его не существует, поэтому разруливать его тебе придется на своей стороне. Хотя еще не поздно, и если ты скажеш что оно сильно усложнит тебе разработку - я чтонить придумаю, например добавлю его как опциональное в хранилище.

Помимо папок есть и тру-ярлыки. Они отрисовываются на сообщениях и по ним можно фильтровать сообщения. Это все ярлыки, кроме тех что мы считаем папками или иных "специальных".

Также есть система фильтрации. Сейчас она умеет фильтровать по любой комбинации ярлыков, дат, почтовых адресов отправителя, получателя и статуса прочитанности. Например чтобы отобразить всю почту, которая ранее была задачами, но была "выполнена", мы устанавливаем соответствующую комбинацию ярлыков.

Для выбора условий фильтрации будет специальное окно. Cоставленные условия поиска можно будет сохранить как готовый пресет и задать ему имя.

Такие пресеты будут называть пользовательскими фильтрами. Некоторые из них будут заранее пред-конфигурированы для каждого нового аккаунта, например для просмотра всех сообщений вообще, всех отправленных, задач которые были "выполнены", или помеченных как спам. По сути с технической стороны наши "папки" являются точно такимиже захардкоженными пресетами, просто отображаться они будут в интерфейсе отдельно.

В списке диалогов будет группировка по датам последней активности (то есть по последнему письму по сути). При этом подгрузка диалогов за следующую дату при прокрутке будет происходить лениво - ты просто текущий пресет фильтрации, но указываешь другую дату. Это сделано не только для удобства, но скорее для снижения нагрузки.

При раскрытии диалога отображаются его сообщения - при этом сообщения могут быть свернуты или развернуты. В свернутом сообщении отображается только одна условная строка контента (условная, поскольку для этого сначала все строки склеиваются пробелом, и сколько поместится столько и видно - смотри иллюстрации). ПОдефолту раскрытыми сообщениями отображаются первое сообщение, и 2-3 последних. Кроме того раскрытыми отображаются сообщения, помеченные тегом "Избранное". Также в ответе апи при фильтрации будет передано, какие дополнительные сообщения нужно раскрыть в диалоге (обычно это именно те сообщения диалога, которые попали под условия фильтрации).

Также есть еще один служебный ярлык - Избранное. Диалоги, в которых есть такой ярлык, отображаются первыми в текущей группе (тоесть в рамках например сегодняшнего дня такие диалоги находятся сверху, остальные же отсортированы по дате последней активности).



[Эскиз](https://docs.google.com/drawings/d/1V_Y-hjgedXos91Gy2jW8ig8PL158IkcwM4JacTA9f_I/edit?usp=sharing) текущей версии концепта.
